app-id: io.github.glitterware.Passy
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: passy
separate-locales: false
finish-args:
- '--share=ipc'
- '--socket=fallback-x11'
- '--socket=wayland'
- '--device=dri'
- '--socket=pulseaudio'
- '--share=network'
- '--filesystem=xdg-documents/Passy:create'
- '--filesystem=~/Documents/Passy'
- '--filesystem=~/Passy:create'
- '--filesystem=~/.mozilla/native-messaging-hosts:create'
- '--filesystem=~/.config/microsoft-edge/NativeMessagingHosts:create'
- '--filesystem=~/.config/google-chrome/NativeMessagingHosts:create'
- '--filesystem=~/.config/chromium/NativeMessagingHosts:create'
- '--filesystem=~/.config/BraveSoftware/Brave-Browser/NativeMessagingHosts:create'
- '--env=LD_LIBRARY_PATH="/app/lib"'
modules:
#region Required dependencies
- shared-modules/libayatana-appindicator/libayatana-appindicator-gtk3.json
- name: libmpv
  cleanup:
  - /include
  - /lib/pkgconfig
  - /share/man
  buildsystem: simple
  build-commands:
  - python3 waf configure --prefix=/app --enable-libmpv-shared --disable-cplayer --disable-build-date
    --disable-alsa
  - python3 waf build
  - python3 waf install
  - ln -s /app/lib/libmpv.so /app/lib/libmpv.so.1
  sources:
  - type: git
    url: https://github.com/mpv-player/mpv.git
    tag: v0.35.1
  - type: file
    url: https://waf.io/waf-2.0.25
    sha256: 21199cd220ccf60434133e1fd2ab8c8e5217c3799199c82722543970dc8e38d5
    dest-filename: waf
  modules:
  - name: libass
    cleanup:
    - /include
    - /lib/*.la
    - /lib/pkgconfig
    config-opts:
    - --disable-static
    sources:
    - type: archive
      url: https://github.com/libass/libass/releases/download/0.17.1/libass-0.17.1.tar.xz
      sha256: f0da0bbfba476c16ae3e1cfd862256d30915911f7abaa1b16ce62ee653192784
    modules:
    - name: fribidi
      cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /lib/*.la
      - /share/man
      buildsystem: meson
      config-opts:
      - --buildtype=release
      - -Ddocs=false
      sources:
      - type: git
        url: https://github.com/fribidi/fribidi.git
        tag: v1.0.13
        commit: b54871c339dabb7434718da3fed2fa63320997e5
  - name: x264
    cleanup:
    - /include
    - /lib/pkgconfig
    - /share/man
    config-opts:
    - --disable-cli
    - --enable-shared
    sources:
    - type: git
      url: https://code.videolan.org/videolan/x264.git
      commit: a8b68ebfaa68621b5ac8907610d3335971839d52
  - name: nv-codec-headers
    cleanup:
    - '*'
    no-autogen: true
    make-install-args:
    - PREFIX=/app
    sources:
    - type: git
      url: https://github.com/FFmpeg/nv-codec-headers.git
      commit: 855f8263d97bbdcaeabaaaa2997e1ccad7c52dc3
  - name: ffmpeg
    cleanup:
    - /include
    - /lib/pkgconfig
    - /share/ffmpeg/examples
    config-opts:
    - --enable-shared
    - --disable-static
    - --enable-gnutls
    - --disable-doc
    - --disable-programs
    - --disable-encoders
    - --disable-muxers
    - --enable-encoder=png
    - --enable-libv4l2
    - --enable-libdav1d
    sources:
    - type: git
      url: https://git.ffmpeg.org/ffmpeg.git
      commit: b98349b2055a93b2a22381bc1a4c09c229f2b3cb
#endregion

- name: passy
  buildsystem: simple
  sources:
  - type: archive
    url: https://github.com/GlitterWare/Passy-Releases/blob/v1.9.0/Passy-v1.9.0-Linux-Bundle-No-Updates-Popup.zip?raw=true
    sha256: d07cd871d9e4c6fc6e28c8d62cb5472c304586ee0d5556cbc69dfbbc8f3705ed
    archive-type: zip
    only-arches: [ 'x86_64' ]
    dest: bundle
  - type: archive
    url: https://github.com/GlitterWare/Passy-Releases/blob/v1.9.0/Passy-v1.9.0-Linux-ARM64-Bundle-No-Updates-Popup.zip?raw=true
    sha256: 53a6d1217b1cac5cac370a2e81c9eaccdd9a325af20dd4a74065e2a9d6c7d009
    archive-type: zip
    only-arches: [ 'aarch64' ]
    dest: bundle
  build-commands:
  - mv bundle/com.glitterware.passy.svg bundle/io.github.glitterware.Passy.svg
  - sed -i 's/com.glitterware.passy/io.github.glitterware.Passy/' bundle/com.glitterware.passy.appdata.xml
  - mv bundle/com.glitterware.passy.appdata.xml bundle/io.github.glitterware.Passy.metainfo.xml
  - sed -i 's/com.glitterware.passy/io.github.glitterware.Passy/' bundle/com.glitterware.passy.desktop
  - mv bundle/com.glitterware.passy.desktop bundle/io.github.glitterware.Passy.desktop
  - mkdir -p /app/Passy
  - cp -r bundle/* /app/Passy
  - chmod +x /app/Passy/passy
  - mkdir -p /app/bin
  - ln -s /app/Passy/passy /app/bin/passy
  - install -Dm644 bundle/io.github.glitterware.Passy.svg -t /app/share/icons/hicolor/scalable/apps
  - install -Dm644 bundle/io.github.glitterware.Passy.metainfo.xml -t /app/share/metainfo  
  - install -Dm644 bundle/io.github.glitterware.Passy.desktop -t /app/share/applications
  
